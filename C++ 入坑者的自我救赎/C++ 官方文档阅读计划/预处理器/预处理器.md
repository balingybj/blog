# 预处理器

> 本篇翻译自 [Preprocessor](https://en.cppreference.com/w/cpp/preprocessor)

预处理器在翻译阶段四执行，早于编译阶段。预处理的结果是单个文件，然后传递给实际的编译器。

## 指令

预处理器的行为通过预处理器指令来控制。每个预处理指令占据一行，具体格式如下：

- `#` 字符
- 预处理指令（包括 `define`、`undef`、`include`、`if`、`ifdef`、`ifndef`、`else`、`elif`、`endif`、`line`、`error`、`pragma` ）
- 实参（依赖具体指令）
- 换行符

可以存在没有任何效果的空指令（# 后紧跟一个换行符）。

从 C++20 起，导入（import）声明也是预处理指令。

预处理器指令不能来自宏展开。

```c++
#define EMPTY
EMPTY   #   include <file.h> // 不是预处理指令
```

## 能力

预处理器具有以下源文件翻译能力：

- 条件编译源文件的某些部分（通过指令 `#if`、`ifdef`、`ifndef`、`#else`、`elif` 、`endif` 控制）
- 替换文本宏，同时可能对标识符进行拼接或加引号（通过指令 `#define`，`#undef` 以及操作符 `#` 和 `##` 控制）
- 包含其他文件（通过指令 `#include` 控制。从 C++17 起，还可以通过 `__has_include` 检查）
- 引发错误（通过指令 `#error` 控制）

可以控制预处理的以下方面：

- 由实现定义的行为（由指令 `#pragma` 以及 C++11 引入的运算符 `_Pragma` 控制）
- 对预处理器可见的文件名和行信息（通过指令 `#line` 控制）

## 脚注

1. 这些指令由标准定义。对于标准未定义的指令：它们可能被忽略，也可能提供某些有用的含义或者导致编译时错误。例如，一个常见的非标准扩展指令 `#warning` ，它会在编译期发出用户定义的消息。即使是被忽略的指令，在执行完预处理后也会从源文件中被移除。

