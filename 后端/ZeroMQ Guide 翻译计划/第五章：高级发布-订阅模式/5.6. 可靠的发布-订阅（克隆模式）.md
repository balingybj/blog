# 可靠的发布-订阅（克隆模式）

作为一个更大的工作示例，本节我们将考虑构建一个可靠的发布-订阅架构。我们将分阶段进行开发。目标允许一组应用共享一些公关状态。以下是我们面临的技术挑战：

- 我们有大量的客户端应用，比如成千上万个。
- 客户端会任意加入或离开网络。
- 所有应用必须共享一个最终一致的状态。
- 任何应用都可以随时更新状态。

我们假设更新的容量相当低。并且不要求实时。整个状态都可以放进内存。一些可信的用例包括：

- 一组云服务器共享的配置。
- 一组玩家共享的游戏状态。
- 实时更新并对应用可见的汇率数据。

## 集中式于分布式

我们需要做的第一个决定是是否使用中央服务器。这对最终的设计有很大影响。权衡如下：

- 从概念上讲，一个中央服务器更容易理解，因为网络不是天生对称的。使用中心服务，可以避免发现、绑定和连接等所有问题。
- 通常，一个完全分布式的体系结构在技术上更具挑战性，但最终会得到一个简单的协议。每个节点都必须正确的充当服务端和客户端，这点很微妙。如果做对了，结果将比使用中央服务更简单。这一点，我们在第四章 - 可靠的请求-应答模式中验证过。
- 在高容量用例中，中央服务器将成为瓶颈。如果需要每秒顺序处理数百万条消息，我们应该立即以分散为目标。
- 讽刺的是，集中式的架构比分布式架构更容易扩展到更多的节点。也就是说，将 10,000 个节点连接到一台服务器比让它们相互连接更容易。

因此，对于克隆模式，我们将使用一个发布状态更新的服务段和一组表示应用程序的客户端。

## 将状态表示为键值对

