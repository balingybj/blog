# 软件|应用管理

## 仓库和服务器

在 Linux 世界，仓库是指因特网上存储软件包的服务器，用户可以从中拉取需要安装的软件包。Manjaro 用户默认使用的是 Manjaro 官方仓库。为了提高访问速度，用户一般访问的是 Manjaro 镜像仓库。Manjaro 组织维护了一个软件仓库，也就是一台服务器，其他不同国家的组织或个人也建了各自的仓库服务器，定期从 Manjaro 维护的服务起同步数据。这些第三方组织维护的仓库中的软件包和 Manjaro 组织维护的仓库中软件一致，叫镜像仓库，Manjaro 组织维护的仓库和第三方组织维护的镜像仓库都叫官方仓库。另外 Manjaro 还可以使用 Arch 的仓库（Arch User Repository，简称 AUR）。

### 选择最快的镜像仓库

Manjaro 仓库分布世界各地，通常离用户最近的访问越快。我们通常选择国内某个大组织维护的镜像仓库。Manjaro 提供了一个实用的命令可以查看当前哪些国家部署的镜像仓库。

```shell
sudo pacman-mirrors --country-list
```

用户从某个镜像仓库拉取软件包的速度由以下三个因素决定：

- 用户本身的网络连接质量
- 镜像仓库服务起自身的网络性能
- 镜像仓库到用户的网络距离

现在大公司维护的镜像仓库服务起网络性能都不错。比如阿里，腾讯，163，毕竟他们财大气粗，他们公司本身的一些服务依赖于自己的镜像仓库，肯定会好好维护。还有一些知名高校维护的镜像仓库，比如清华，中科大。教育网用户可以优选选择高校提供的仓库。

除了网络访问速度外，镜像仓库的稳定性也必须考虑。比如我还在西电读书时，我们学校相关社团维护的镜像仓库就不稳定，因为资金不足，网络流量有限，镜像同步偶尔会不及时，甚至无法访问。

### 自动更新镜像仓库列表

pacman-mirrors 命令可以自动确认网络访问最快的镜像仓库并更新镜像列表。参见 [Pacman-mirrors](https://wiki.manjaro.org/index.php?title=Pacman-mirrors)

```shell
sudo pacman-mirrors --fasttrack && sudo pacman -Syyu
```

### 手动修改镜像仓库列表

用户还可以手动编辑 mirrorlist 文件，更新里面的仓库列表地址。

```shell
sudo vim /etc/pacman.d/mirrorlist
```

更新完 mirrorlist 文件后还需要手动同步一下。

```shell
sudo pacman -Syyu
```

Manjaro 系统本身维护了一个数据库，里面保存了官方仓库中所有软件包的索引。`sudo pacman -Syyu` 的同步就是更新这些索引，让它们关联到当前所选镜像仓库的最新状态。重新选择仓库后，之前的索引就不再正确，所以每次更换仓库都需要重新同步一下啊。pacman 正是根据这些索引从仓库下载并安装软件包。

## 软件分支

Manjaro 和其他 Arch 系发行版显著不同的特性之一就是有自己专用的软件分支，不依赖 Arch 提供。为了保持可持续性和稳定性，Manjaro 使用了三种分支：

- 稳定分支：稳定分支中软件包在进入该分支之前在不稳定分支/测试分支中经过了几周时间的测试，通常不会有什么问题。
- 测试分支：使用该分支的用户是第二道防线。测试分支的用户比不稳定分支的用户多得多，他们下载带有不稳定分支用户反馈的包，并完善他们。
- 不稳定分支：一般在 Arch 软件包发布的三天内，会被修改以适配 Manjaro，然后放到不稳定分支中。使用不稳定分支的用户需要熟练掌握一些技能，在进入到不稳定状态时能摆脱麻烦。感谢不稳定分支用户的反馈，在其他 Manjaro 用户使用的接触到软件包之前，大多数 bug 都被发现并修复。虽然该分支上拥有最新的软件包，但使用不稳定分支可能会破坏你的系统！

总结一下就是，不稳定的包在不稳定分支上测试。一旦它们稍微稳定了就提交到测试分支，在测试分支上将经过更多测试，在确保稳定性后提交到稳定分支。

> 注意：不稳定分支上的软件包直接来源于 Arch Linux 的稳定分支

### 切换分支

切换分支需要修改 pacman-mirrors 的配置。

```shell
sudo pacman-mirrors --api --set-branch [stable | testing | unstable]
```

然后重新构建 mirrorlist 并更新包：

```shell
sudo pacman-mirrors --fasttrack 5 && sudo pacman -Syyu
```

如果想切换回原来的分支，重复上面的步骤即可。

如果你处于某种原因，在切换分支的同时想“降级包”，更新包时使用额外的 `u` 参数即可：

```shell
sudo pacman -Syyuu
```

