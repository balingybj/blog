# 编码规范

> 本文翻译自 [Coding Conventions](https://kotlinlang.org/docs/reference/coding-conventions.html)

本页包含了 Kotlin 当前使用的编码规范。

- 源码组织
- 命名规范
- 格式化
- 文档注释
- 避免冗余的结构
- 语言特性的惯用法
- 库的编码规范

## 应用风格指南

如果需要根据本风格指南配置 IntelliJ 格式化程序，请安装 Kotlin 插件 1.2.20 或更高版本，转到 Settings | Editor | Code Style | Kotlin，点击右上角的 Set from… 链接，并从菜单中选择 Predefined style | Kotlin style guide。

如需验证代码已按风格指南格式化，请转到探查设置（Inspections）并启用 Kotlin | Style issues | File is not formatted according to project settings 探查项。 验证风格指南中描述的其他问题（如命名约定）的附加探查项默认已启用。

## 源代码组织

### 目录结构

在纯 Kotlin 项目中，建议目录结构和包结构一致，并省略公共 root 包。例如，如果项目中所有得代码都在 `org.example.kotlin` 包极其子包中，则 `org.example.kotlin` 包中的文件应该直接放在源码根目录下，`org.example.kotlin.network.socket` 包中的文件应该放在源码根目录的子目录 `network/socket` 中。

> 对于 JVM 平台：Kotlin 和 Java 共存的项目，Kotlin 源文件应当与 Java 源文件位于同一源文件根目录下， 并遵循相同的目录结构：每个文件应放置在与其 package 语句对应的目录中。

### 源文件名称

如果一个 Kotlin 文件只包含一个类（以及可选的顶层声明），则文件名应该和类名相同，并添加 `.kt` 后缀名。如果一个文件包含多个类或者只包含顶层声明，则挑选一个能描述文件内容的名称。文件名使用首字母大写的驼峰命名法（例如，`ProcessDeclarations.kt`）。

文件名应该描述文件中代码的作用。避免在文件名中使用诸如 “Util” 的无意义单词。

### 源文件组织

Kotlin 鼓励将语义上紧密关联的多个声明（类，顶级函数，属性）放置到同一个文件中，不过文件要保持合理大小（不超过几百行）。

特别是在为类定义与类的所有客户都相关的扩展函数时，请将扩展函数的定义放在与类自身定义相同的地方。当为某个特定客户定义扩展函数时，将定义和客户代码放在一起。不要仅仅为了定义某个类的所有扩展函数，而将它们都放到相同的文件中。

### 类布局

通常，一个类的内容按以下顺序排列：

- 属性声明和初始化块
- 次构造函数
- 方法声明
- 伴生对象

不要按字母顺序或可见性来排序方法声明，也不要分开普通方法和扩展方法。而是要跟进相关性来组织和排序，这样别人从上到下阅读代码时能跟进事情发生的逻辑。选择一个排序标准（由高层到底层，或者反过来）并坚持到底。

将嵌套类放到使用它的代码之后。如果嵌套类打算在外部使用，并且在类内部没有引用，将嵌套类的定义放在最后，在半生对象之后。

### 接口实现布局

实现一个接口时，实现的成员顺序应该和接口中的程序顺序保持一致（如果需要，插入用于实现的额外私有方法）。

### 重载布局

重载的方法应该放在一起。

## 命名规则

Kotlin 中的包和类命名规则非常简单：

- 包名总是小写，并且不能使用下划线。不鼓励使用多个单词的名称，如果你确实需要使用多个单词，你可以简单地将它们连接在一起，或者使用驼峰大小写（例如 `org.example.myProject`）。

- 类和对象的名称使用首字母大写的驼峰命名法、

    ```kotlin
    open class DeclarationProcessor { /*...*/ }
    
    object EmptyDeclarationProcessor : DeclarationProcessor() { /*...*/ }
    ```

### 函数名称

函数、属性、以及变量使用小写字母开头的驼峰命名法，并且不能使用下划线：

```kotlin
fun processDeclarations() { /*...*/ }
var declarationCount = 1
```

例外：创建类实例的工厂函数可以与正在创建的类使用相同的名称：

```kotlin
abstract class Foo { /*...*/ }

class FooImpl : Foo { /*...*/ }

fun FooImpl(): Foo { return FooImpl() }
```

### 测试函数的名称

**当且仅当**在测试中，可以使用反引号括起来的带空格的方法名。 （请注意，Android 运行时目前暂不支持这样的方法名。）测试代码中也允许方法名使用下划线。

```kotlin
class MyTestCase {
     @Test fun `ensure everything works`() { /*...*/ }
     
     @Test fun ensureEverythingWorks_onAndroid() { /*...*/ }
}
```

### 属性名

常量名称（被 const 标记的属性，保存不可变数据的顶层变量，或没有自定义 `get` 函数的对象 `val` 属性）应该使用大写、下划线分割的名词：

```kotlin
const val MAX_COUNT = 8
val USER_NAME_FIELD = "UserName"
```

保存带有行为的对象或者可变数据的顶层变量或对象属性的应该使用驼峰风格名称：

```kotlin
val mutableCollection: MutableSet<String> = HashSet()
```

持有单例对象的属性名可以使用与 `object` 声明相同的命名风格：

```kotlin
val PersonComparator: Comparator<Person> = /*...*/
```

对于枚举常量，可以使用大写、下划线分割的名称（例如，`enum class Color { RED, GREEN }`）或者首字母大写的驼峰命名法，根据用途选择。

### 备份属性名称

如果一个类有两个在概念上相同的属性，但一个属于公共 API，另一个属于实现细节（私有属性），则使用下划线作为后者名称的前缀。

```kotlin
class C {
    private val _elementList = mutableListOf<Element>()

    val elementList: List<Element>
         get() = _elementList
}
```

### 选择好的名称

类的名称通常是一个名词或名词短语，用来解释类*是什么*，例如`List`, `PersonReader`。

方法的名称通常是一个动词或动词短语，述说方法*做了什么*：`close`，`readPersons`。修改或返回一个新对象的的方法也应该遵循这条命名规则。例如，`sort` 会就地排序一个集合，而 `sorted` 返回一个排序后的集合副本。

名称应该清晰的实体的目的，最好避免在名称中使用无意义的单词（例如 `Manager`，`Wrapper` 等等）。

当使用缩写词作为名称的一部分时，如果缩写词只有两个字母，则都应该大写，如果缩写词超过两个字母则只首字母大写（例如，`XmlFormatter`, `HttpInputStream`）。



## 格式化

使用 4 个空格缩进，而不是 tab。

对于花括号，将左花括号放在结构开始的行尾，将右花括号放在与结构水平对齐的单独一行。

```kotlin
if (elements != null) {
    for (element in elements) {
        // ...
    }
}
```

（注意：在 Kotlin 中，分号是可选的，所以换行非常重要。语言设计采用了 Java 的花括号，如果尝试使用不同的格式化风格，可能会遇到意外行为。）

### 横向空白

在二元操作符前后各留一个空格（例如 `a + b`）。例外情况：不要在 “range to” 操作符（例如`0..i`）前后留空格。

不要在一元操作符（例如 `a++`）前后留空格。

在控制流关键字（if、when、for 以及 while）和相应的左括号之间留空格。

不要在主构造函数声明，方法声明互方法调用的左括号前留空格。

```kotlin
class A(val x: Int)

fun foo(x: Int) { ... }

fun bar() {
    foo(1)
}
```

永远不要在 `(`, `[`, or before `]`, `)` 之后留空格。

永远不要在 `.` 或 `?.` 前后留空格，例如 `foo.bar().filter { it > 2 }.joinToString()`、`foo?.bar()`。

在 `//` 之后留一个空格：`// 这是一行注释`

不要在指定类型的尖括号前后留空格，例如 `class Map<K, V> { ... }`

不要在 `::` 前后留空格，例如：`Foo::class`, `String::length`

不要在 `?` 前留空格，例如 `String?`

一般来说，要避免任何形式的水平对齐。将标识符重命名为不同长度的名称不应影响任何声明或任何用法的格式。

### 冒号

以下场景的 `:` 前面需要留一个空格：

- 用于分割一个类型和超类型时
- 用于委托给超类的构造函数或同一个类的另一个构造函数时
- 出现在 `object` 关键字之后时

当 `:` 分割一个声明和它的类型时，不要在前面添加空格。

`:` 之后总是跟一个空格：

```kotlin
abstract class Foo<out T : Any> : IFoo {
    abstract fun foo(a: Int): T
}

class FooImpl : Foo() {
    constructor(x: String) : this(x) { /*...*/ }
    
    val x = object : IFoo { /*...*/ } 
}
```


















































